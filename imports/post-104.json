{
    "comments": [{
        "timestamp": 1385449200000,
        "by": "Anonymous",
        "text": "THis actually works! You sir, have won the\ninternet. Congrats!",
        "title": "works!"
    }],
    "tags": ["css", "html", "javascript", "php", "web-dev"],
    "title": "Simple and Effective Fix for the WordPress wpautop()\nMadness",
    "html": "<p>You may be familiar with the problems related to WordPress\n<span class=\"geshifilter\"><code class=\"text geshifilter-text\">wpautop()</code></span> function. The most\nnotable problem is that your WordPress pages will leave you with\nempty paragraphs. The empty paragraphs can't be removed by simply\nremoving <span class=\"geshifilter\"><code class=\"text geshifilter-text\">&lt;p>&lt;/p></code></span> with a\nfind and replace. It turns out that the result HTML doesn't\nactually have <span class=\"geshifilter\"><code class=\"text geshifilter-text\">&lt;p>&lt;/p></code></span>. But the\nempty paragrapsh do show up in the DOM tree.</p>\n<p>A quick DOM inspection using Firebug, Chrome, etc. shows the\nempty paragraphs. But where do they come from? It turns out that if\nyour html has paragraph tags around a block-level element, the\nbrowser will interpret the HTML as an empty paragraph before and\nafter. Take the following example.</p>\n<div class=\"geshifilter\">\n<pre class=\"text geshifilter-text\">\n&lt;!-- invalid HTML ... -->\n&lt;p>&lt;form>...&lt;/form>&lt;/p>\n \n&lt;!-- ... which the browser interprets as: -->\n&lt;p>&lt;/p>&lt;form>...&lt;/form>&lt;p>&lt;/p>\n</pre></div>\n<p>There are a lot of proposed solutions out there including\nrolling a <a target=\"_blank\" href=\"http://ilikekillnerds.com/2011/01/how-to-stop-wordpress-wrapping-images-in-p-tags/\">\ncustom wpautop function</a>, <a target=\"_blank\" href=\"http://wordpress.org/support/topic/remove-ltpgt-ltpgt-around-ltphp-the_content-gt#post-258177\">\nremoving the wpautop filter entirely</a>, using the new <a target=\"_blank\" href=\"http://digwp.com/2009/10/clean-up-empty-elements-css3/\">:empty CSS\npseudoselector</a>, and even <a target=\"_blank\" href=\"http://wordpress.stackexchange.com/questions/13798/remove-empty-paragraphs-from-the-content#answer-37700\">\nusing JavaScript</a> to remove empty paragraphs. Plus some people\nare advocating a <a target=\"_blank\" href=\"http://stackoverflow.com/questions/3809108/how-to-remove-empty-paragraph-tags-from-string\">\nfind and replace</a> which will have no effect for most people as I\nmention above.</p>\n<p>After a lot of contemplation, I relized that there is a simple\nsolutionâ€”removing instances of <span class=\"geshifilter\"><code class=\"text geshifilter-text\">&lt;p></code></span> tag immediately\nprecede block-level elements and removing instances of closing tags\nfor block-level elements that immediately precede <span class=\"geshifilter\"><code class=\"text geshifilter-text\">&lt;/p></code></span>.</p>\n<p>Putting the following code in your theme's functions.php will do\nthe trick.</p>\n<div class=\"geshifilter\">\n<pre class=\"php geshifilter-php\">\nadd_filter<span class=\"br0\">(</span><span class=\"st_h\">'the_content'</span><span class=\"sy0\">,</span> <span class=\"st_h\">'fix_autop'</span><span class=\"br0\">)</span><span class=\"sy0\">;</span>\nadd_filter<span class=\"br0\">(</span><span class=\"st_h\">'the_excerpt'</span><span class=\"sy0\">,</span> <span class=\"st_h\">'fix_autop'</span><span class=\"br0\">)</span><span class=\"sy0\">;</span>\n<span class=\"kw2\">function</span> fix_autop<span class=\"br0\">(</span><span class=\"re0\">$content</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>\n        <span class=\"re0\">$html</span> <span class=\"sy0\">=</span> <span class=\"kw3\">trim</span><span class=\"br0\">(</span><span class=\"re0\">$content</span><span class=\"br0\">)</span><span class=\"sy0\">;</span>\n        <span class=\"kw1\">if</span> <span class=\"br0\">(</span> <span class=\"re0\">$html</span> <span class=\"sy0\">===</span> <span class=\"st_h\">''</span> <span class=\"br0\">)</span> <span class=\"br0\">{</span>\n                <span class=\"kw1\">return</span> <span class=\"st_h\">''</span><span class=\"sy0\">;</span>  \n        <span class=\"br0\">}</span>\n        <span class=\"re0\">$blocktags</span> <span class=\"sy0\">=</span> <span class=\"st_h\">'address|article|aside|audio|blockquote|canvas|caption|center|col|del|dd|div|dl|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|header|hgroup|iframe|ins|li|nav|noframes|noscript|object|ol|output|pre|script|section|table|tbody|td|tfoot|thead|th|tr|ul|video'</span><span class=\"sy0\">;</span>\n        <span class=\"re0\">$html</span> <span class=\"sy0\">=</span> <span class=\"kw3\">preg_replace</span><span class=\"br0\">(</span><span class=\"st_h\">'~&lt;p>\\s*&lt;('</span><span class=\"sy0\">.</span><span class=\"re0\">$blocktags</span><span class=\"sy0\">.</span><span class=\"st_h\">')\\b~i'</span><span class=\"sy0\">,</span> <span class=\"st_h\">'&lt;$1'</span><span class=\"sy0\">,</span> <span class=\"re0\">$html</span><span class=\"br0\">)</span><span class=\"sy0\">;</span>\n        <span class=\"re0\">$html</span> <span class=\"sy0\">=</span> <span class=\"kw3\">preg_replace</span><span class=\"br0\">(</span><span class=\"st_h\">'~&lt;/('</span><span class=\"sy0\">.</span><span class=\"re0\">$blocktags</span><span class=\"sy0\">.</span><span class=\"st_h\">')>\\s*&lt;/p>~i'</span><span class=\"sy0\">,</span> <span class=\"st_h\">'&lt;/$1>'</span><span class=\"sy0\">,</span> <span class=\"re0\">$html</span><span class=\"br0\">)</span><span class=\"sy0\">;</span>\n        <span class=\"kw1\">return</span> <span class=\"re0\">$html</span><span class=\"sy0\">;</span>\n<span class=\"br0\">}</span>\n</pre></div>\n<p>Happy WordPress coding!</p>",
    "timestamp": 1351836000000,
    "slug": "simple-and-effective-fix-for-the-wordpress-wpautop-madness",
    "nid": 104
}